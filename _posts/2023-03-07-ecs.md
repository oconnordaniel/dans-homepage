---
title: Elastic Container
date: 2023-03-05 10:00:00 -700
catagories: [aws]
tags: [aws]
---


## Create cluster

``` bash
aws ecs create-cluster --cluster-name dans-homepage
aws ecs list-clusters
```

## Upload container to ECR

```bash
aws ecr get-login-password --region us-west-2 | docker login --username AWS --password-stdin 597070230033.dkr.ecr.us-west-2.amazonaws.com
docker build -t dans-homepage .
docker tag dans-homepage:latest 597070230033.dkr.ecr.us-west-2.amazonaws.com/dans-homepage:latest
docker push 597070230033.dkr.ecr.us-west-2.amazonaws.com/dans-homepage:latest
```

## Create Task definition

``` bash
aws ecs register-task-definition --cli-input-json file://`pwd`/dans-task-def.json
aws ecs list-task-definitions
```

``` json : dans-task-def.json
{
    "containerDefinitions": [
        {
            "name": "dans-homepage", 
            "image": "597070230033.dkr.ecr.us-west-2.amazonaws.com/dans-homepage:latest"
            "portMappings": [
                {
                    "containerPort": 80, 
                    "hostPort": 80, 
                    "protocol": "tcp"
                }
            ]
        }
    ], 
    "memory": "512",
    "cpu": "256", 
    "networkMode": "awsvpc", 
    "family": "http-server", 
    "requiresCompatibilities": [
        "FARGATE"
    ]
}
```

## Create service

```bash
aws ec2 describe-subnets 
aws ec2 describe-security-groups
```

Take note of the SubnetId # subnet-0049d42d494e6563a
Take note of the GroupId # sg-096e303e18dbb67bd

``` bash
aws ecs create-service \
--cluster dans-homepage \
--service-name dans-homepage \
--task-definition dans-homepage:5 \
--desired-count 1 \
--launch-type "FARGATE" \
--network-configuration "awsvpcConfiguration={subnets=[subnet-0049d42d494e6563a,subnet-01753e2313b8a8532,subnet-0b19d4d273bd26f65,subnet-07b03a60d97f0b5eb],securityGroups=[sg-096e303e18dbb67bd], assignPublicIp=ENABLED}"
```

``` bash
aws ecs list-services --cluster dans-homepage

aws ecs list-tasks --cluster dans-homepage
aws ecs describe-tasks --cluster dans-homepage --tasks "arn:aws:ecs:us-west-2:597070230033:task/dans-homepage/d765a4dad128495ab8141228c61d2033"

aws ec2 describe-network-interfaces --network-interface-id "eni-0670deeb6ae5bbddb"

```

## Resources

[video link](https://www.youtube.com/watch?v=9KWgTuQGEGQ&t=539s)
